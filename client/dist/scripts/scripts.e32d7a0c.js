"use strict";function runBlock(a,b,c,d){a.defaults.headers.get={"Content-Type":"application/json;charset=utf-8",Accept:"application/json"},a.defaults.headers.post={"Content-Type":"application/json;charset=utf-8",Accept:"application/json"},a.defaults.headers.put={"Content-Type":"application/json;charset=utf-8",Accept:"application/json"},"1"==d.get("isLoggedIn")?console.log("已登录"):(console.log("未登录"),c.path("/login"))}angular.module("clientApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","ui.router"]).constant("apiUrl","http://sxnk110.workerhub.cn:9000/api/v1").constant("hostUrl","http://sxnk110.workerhub.cn:9000").constant("cloudUrl","http://storage.workerhub.cn/").constant("ToKenHeader","X-AUTH-TOKEN").config(["$routeProvider","$stateProvider","$locationProvider",function(a,b,c){a.when("/",{templateUrl:"views/welcome.html",controller:"MainCtrl"}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/addpost",{templateUrl:"views/addpost.html",controller:"AddpostCtrl"}).when("/viewpost/:postId",{templateUrl:"views/viewpost.html",controller:"ViewpostCtrl"}).when("/article/add",{templateUrl:"views/article/add.html",controller:"ArticleCtrl"}).when("/article/:id/update",{templateUrl:"views/article/update.html",controller:"ArticleCtrl"}).when("/article/list",{templateUrl:"views/article/list.html",controller:"ArticleCtrl"}).when("/article/categories",{templateUrl:"views/article/categories.html",controller:"ArticleCtrl"}).when("/user/:id/update",{templateUrl:"views/user/update.html",controller:"UserCtrl"}).when("/user/list",{templateUrl:"views/user/list.html",controller:"UserCtrl"}).when("/comment/list",{templateUrl:"views/comment/list.html",controller:"CommentCtrl"}).when("/category/add",{templateUrl:"views/category/add.html",controller:"CategoryCtrl"}).when("/category/list",{templateUrl:"views/category/list.html",controller:"CategoryCtrl"}).when("/video/add",{templateUrl:"views/video/add.html",controller:"VideoCtrl"}).when("/video/list",{templateUrl:"views/video/list.html",controller:"VideoCtrl"}).when("/video/categories",{templateUrl:"views/video/categories.html",controller:"VideoCtrl"}).when("/video/:id/update",{templateUrl:"views/video/update.html",controller:"VideoCtrl"}).when("/question/list",{templateUrl:"views/question/list.html",controller:"QuestionCtrl"}).when("/question/categories",{templateUrl:"views/question/categories.html",controller:"QuestionCtrl"}).when("/user/list",{templateUrl:"views/user/list.html",controller:"UserCtrl"}).when("/expertInfo/article",{templateUrl:"views/expertInfo/article.html",controller:"ExpertInfoCtrl"}).when("/expertInfo/album",{templateUrl:"views/expertInfo/album.html",controller:"ExpertInfoCtrl"}).when("/trade/list",{templateUrl:"views/trade/list.html",controller:"TradeCtrl"}).when("/trade/categories",{templateUrl:"views/trade/categories.html",controller:"TradeCtrl"}).when("/link/add",{templateUrl:"views/link/add.html",controller:"LinkCtrl"}).when("/link/list",{templateUrl:"views/link/list.html",controller:"LinkCtrl"}).when("/adv/add",{templateUrl:"views/adv/add.html",controller:"AdvCtrl"}).when("/adv/:id/update",{templateUrl:"views/adv/update.html",controller:"AdvCtrl"}).when("/adv/list",{templateUrl:"views/adv/list.html",controller:"AdvCtrl"}).when("/expert/list",{templateUrl:"views/expert/list.html",controller:"ExpertCtrl"}).when("/expert/categories",{templateUrl:"views/expert/categories.html",controller:"ExpertCtrl"}).when("/admin/list",{templateUrl:"views/admin/list.html",controller:"AdminCtrl"}).when("/message/list",{templateUrl:"views/message/list.html",controller:"MessageCtrl"}).when("/app/list",{templateUrl:"views/app/list.html",controller:"AppCtrl"}).when("/app/upload",{templateUrl:"views/app/upload.html",controller:"AppCtrl"}).otherwise({redirectTo:"/"})}]).directive("observe",function(){return{restrice:"EA",controller:["$scope","pagerConfig","$location",function(a,b,c){a.currentPage=c.search().currentPage?parseInt(c.search().currentPage):1,a.selectPage=function(a){c.search("currentPage",a)},a.getCurPage=function(){return a.currentPage},a.next=function(){a.isLast()||a.selectPage(a.currentPage+1)},a.provie=function(){a.isFirst()||a.selectPage(a.currentPage-1)},a.first=function(){a.selectPage(1)},a.last=function(){a.selectPage(a.totalPages-1)},a.isFirst=function(){return a.currentPage<=1},a.isLast=function(){return a.currentPage>=a.totalPages-1},a.getText=function(a){return b.text[a]}}],link:function(a,b,c){a.itemsPerpage=c.itemsperpage||1,a.listSizes=c.listsizes,c.$observe("totalitems",function(b){a.totalItems=b})},templateUrl:"include/page.html"}}).constant("pagerConfig",{text:{first:"首页",provie:"上一页",next:"下一页",last:"尾页"}}).directive("header",function(){return{restrict:"E",transclude:!0,scope:{title:"@"},templateUrl:"include/header.html"}}).directive("footer",function(){return{restrict:"E",transclude:!0,scope:{title:"@"},templateUrl:"include/footer.html"}}).filter("trustHtml",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]).filter("trustUrl",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]).filter("replaceHtml",function(){return function(a){return a.replace(/<\/?[^>]*>/g,"").substr(0,255)+"..."}}).filter("resourceUrl",function(){return function(a){return"http://storage.workerhub.cn/"+a}}).filter("showStatus",function(){return function(a){var b;switch(a){case"WAIT_AUDITED":b="待审核";break;case"AUDITED":b="审核通过";break;case"FAILED":b="审核失败";break;case"WAIT_RESOLVE":b="待解决";break;case"RESOLVED":b="已解决";break;default:b="未知"}return b}}).run(runBlock),runBlock.$inject=["$http","$cookies","$location","$cookieStore"],angular.module("clientApp").controller("MainCtrl",["$scope","$http",function(a,b){}]),angular.module("clientApp").controller("SignupCtrl",["$scope","$http","$log","alertService","$location","userService","signupService","apiUrl",function(a,b,c,d,e,f,g,h){a.signup=function(){var b={email:a.email,password:a.password,phone:a.phone,name:a.name};g.signup(b,function(b){b.data.hasOwnProperty("success")&&(f.username=a.email,e.path("/dashboard"))},function(a){400===a.status&&angular.forEach(a.data,function(a,b){"email"===b||"password"===b?d.add("danger",b+" : "+a):d.add("danger",a.message)}),500===status&&d.add("danger","Internal server error!")})}}]),angular.module("clientApp").factory("alertService",["$timeout",function(a){function b(b,d,e){return e?a(function(){c(this)},e):a(function(){c(this)},g),i.push({type:b,msg:d,close:function(){return c(this)}})}function c(a){return d(i.indexOf(a))}function d(a){return i.splice(a,1)}function e(){i=[]}function f(){return i}var g=3e3,h={add:b,closeAlert:c,closeAlertIdx:d,clear:e,get:f},i=[];return h}]),angular.module("clientApp").controller("AlertsCtrl",["$scope","alertService",function(a,b){a.alerts=b.get()}]),angular.module("clientApp").controller("DashboardCtrl",["$scope","$log","$http","alertService","$location",function(a,b,c,d,e){a.loadPosts=function(){c.get("/app/userposts").error(function(a,b){401===b?e.path("/login"):d.add("danger",a.error.message)}).success(function(b){a.posts=b})}}]),angular.module("clientApp").factory("userService",function(){var a="";return{username:a}}),angular.module("clientApp").controller("MenuCtrl",["$scope","$http","userService","$location","apiUrl","$cookies","$cookieStore",function(a,b,c,d,e,f,g){a.user=c,a.logout=function(){b({method:"GET",url:e+"/admin/logout",headers:{"X-AUTH-TOKEN":g.get("authToken")}}).then(function(a){a.data.hasOwnProperty("success")&&(f.isLoggedIn=!1,g.put("isLoggedIn",0),c.username="",d.path("/login"))},function(a){console.log("uploadToken获取失败")})},"0"==g.get("isLoggedIn")?(console.log("未登录"),d.path("/login"),a.isLoggedIn=!1):(console.log("已登录"),a.isLoggedIn=!0)}]),angular.module("clientApp").controller("SubMenuCtrl",["$scope","$http","$interval","userService","$location","apiUrl","$cookies","$cookieStore","deskNotice",function(a,b,c,d,e,f,g,h,i){a.questionMessageCount=h.get("questionMessageCount")?h.get("questionMessageCount"):"",a.tradeMessageCount=h.get("tradeMessageCount")?h.get("tradeMessageCount"):"",a.commentMessageCount=h.get("commentMessageCount")?h.get("commentMessageCount"):"",a.lookMessage=function(b){"question"==b?(h.put("questionMessageCount",""),a.questionMessageCount=""):"trade"==b?(h.put("tradeMessageCount",""),a.tradeMessageCount=""):"comment"==b&&(h.put("commentMessageCount",""),a.commentMessageCount="")},a.getNewMessages=function(){b({method:"GET",url:f+"/new/questions",headers:{"X-AUTH-TOKEN":h.get("authToken")}}).then(function(b){b.data.length>0&&(a.newQuestions=b.data,h.put("questionMessageCount",b.data.length+"+"),console.log("新问题数:"+b.data.length),""!=a.questionMessageCount&&i.showDeskNotice("有"+b.data.length+"+ 新的问题,请尽快审核","点击查看","question"))},function(a){console.log("新问题获取失败")}),b({method:"GET",url:f+"/new/trades",headers:{"X-AUTH-TOKEN":h.get("authToken")}}).then(function(b){b.data.length>0&&(a.newTrades=b.data,h.put("tradeMessageCount",b.data.length+"+"),console.log("新交易数:"+b.data.length),""!=a.tradeMessageCount&&i.showDeskNotice("有"+b.data.length+"+ 新的交易,请尽快审核","点击查看","trade"))},function(a){console.log("新交易获取失败")}),b({method:"GET",url:f+"/new/comments",headers:{"X-AUTH-TOKEN":h.get("authToken")}}).then(function(b){b.data.length>0&&(a.newComments=b.data,h.put("commentMessageCount",b.data.length+"+"),console.log("新评论数:"+b.data.length),""!=a.commentMessageCount&&i.showDeskNotice("有"+b.data.length+"+ 新的评论,请尽快审核","点击查看","comment"))},function(a){console.log("新评论获取失败")})},a.getNewMessages(),c(function(){a.getNewMessages(),console.log("获取新消息"),a.questionMessageCount=h.get("questionMessageCount")?h.get("questionMessageCount"):"",a.tradeMessageCount=h.get("tradeMessageCount")?h.get("tradeMessageCount"):"",a.commentMessageCount=h.get("commentMessageCount")?h.get("commentMessageCount"):""},3e5)}]),angular.module("clientApp").controller("LoginCtrl",["$scope","userService","signupService","$cookies","$cookieStore","$location","$log","$http","alertService","apiUrl","hostUrl",function(a,b,c,d,e,f,g,h,i,j,k){a.isAuthenticated=function(){b.username?(g.debug(b.username),f.path("/whelcome")):c.isAuthenticated({},function(a){console.log(a.data),a.data.hasOwnProperty("success")&&(b.username=a.data.success.user,f.path("/whelcome"))},function(a){f.path("/login")})},a.isAuthenticated(),a.login=function(){var b={email:this.email,password:this.password};h.post(j+"/admin/login",b).error(function(a,b){400===b?angular.forEach(a,function(a,b){"email"===b||"password"===b?i.add("danger",b+" : "+a):i.add("danger",a.message)}):401===b?i.add("danger","Invalid login or password!"):500===b?i.add("danger","Internal server error!"):i.add("danger",a)}).success(function(b){console.log("登录成功"),console.log(b),b.hasOwnProperty("authToken")&&(d.isLoggedIn=!0,e.put("isLoggedIn",1),e.put("authToken",b.authToken),a.isAuthenticated()),console.log(e.get("authToken"))})}}]),angular.module("clientApp").controller("AddpostCtrl",["$scope","$http","alertService","$location",function(a,b,c,d){a.post=function(){var e={subject:a.subject,content:a.content};b.post("/app/post",e).error(function(a,b){400===b?angular.forEach(a,function(a,b){"subject"===b||"content"===b?c.add("danger",b+" : "+a):c.add("danger",a.message)}):401===b?d.path("/login"):500===b?c.add("danger","Internal server error!"):c.add("danger",a)}).success(function(b){a.subject="",a.content="",c.add("success",b.success.message)})}}]),angular.module("clientApp").controller("ViewpostCtrl",["$scope","$http","$routeParams","alertService","$location","userService",function(a,b,c,d,e,f){a.user=f,a.params=c,a.postId=a.params.postId,a.viewPost=function(){b.get("/app/post/"+a.postId).error(function(a){d.add("danger",a.error.message)}).success(function(b){a.post=b})},a.viewPost(),a.addComment=function(){var c={postId:a.postId,comment:a.comment};b.post("/app/comment",c).error(function(a,b){400===b?angular.forEach(a,function(a,b){"comment"===b?d.add("danger",b+" : "+a):d.add("danger",a.message)}):401===b?e.path("/login"):500===b?d.add("danger","Internal server error!"):d.add("danger",a)}).success(function(b){d.add("success",b.success.message),a.comment="",a.viewPost()})}}]),angular.module("clientApp").service("articleService",["$http","$cookies","apiUrl","$cookieStore","ToKenHeader",function(a,b,c,d,e){var f=this;return f.addArticle=function(b,e,f){a({method:"POST",url:c+"/article",headers:{"X-AUTH-TOKEN":d.get("authToken")},data:{title:b.title,subTitle:b.subTitle,content:b.content,tag:b.tag,sort:b.sort,image:b.image,categoryId:b.categoryId}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.updateArticle=function(b,e,f){a({method:"PUT",url:c+"/article/"+b.articleId,headers:{"X-AUTH-TOKEN":d.get("authToken")},data:{title:b.title,subTitle:b.subTitle,content:b.content,tag:b.tag,sort:b.sort,image:b.image,categoryId:b.categoryId}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.getArticle=function(b,e,f){a({method:"GET",url:c+"/article/"+b.articleId,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.getArticles=function(b,e,f){a({method:"GET",url:c+"/articles?pageSize=20&page="+b.curPage,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.deleteArticle=function(b,e,f){a({method:"DELETE",url:c+"/article/"+b.id,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.pushArticle=function(b,e,f){a({method:"POST",url:c+"/article/push/"+b.id,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f}]),angular.module("clientApp").controller("ArticleCtrl",["$scope","$routeParams","$rootScope","$http","alertService","$location","articleService","categoryService","cloudUrl","apiUrl","$cookieStore",function(a,b,c,d,e,f,g,h,i,j,k){a.curPage=f.search().currentPage?f.search().currentPage:1,a.imageData="null",a.getArticles=function(){g.getArticles({curPage:a.curPage},function(b){console.log(b.data),a.articles=b.data},function(a){console.log("文章获取失败")})},a.getArticles(),a.getArticleInfo=function(){g.getArticle({articleId:b.id},function(b){console.log(b.data);var c=b.data;a.title=c.title,a.subTitle=c.subTitle,a.content=c.content,editor.setValue(c.content),a.tag=c.tag,a.sort=c.sort,a.imageData=c.image,a.cateImage=i+c.image,a.categoryId=c.category.id},function(a){e.add("error",a.data.success.message)})},null!=b.id&&a.getArticleInfo(),a.addArticle=function(){g.addArticle({title:a.title,subTitle:a.subTitle,content:editor.getValue(),tag:a.tag,sort:a.sort,image:a.imageData,categoryId:a.categoryId},function(b){a.subject="",a.content="",e.add("success",b.data.success.message),f.path("/article/list")},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"title"===b||"content"===b||"categoryId"==b?e.add("danger",b+" : "+a):e.add("danger",a.message)}):401===a.status?f.path("/login"):500===a.status?e.add("danger","Internal server error!"):e.add("danger",a.date)})},a.updateArticle=function(){g.updateArticle({articleId:b.id,title:a.title,subTitle:a.subTitle,content:editor.getValue(),tag:a.tag,sort:a.sort,image:a.imageData,categoryId:a.categoryId},function(b){a.subject="",a.content="",e.add("success",b.data.success.message),f.path("/article/list")},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"title"===b||"content"===b||"categoryId"==b?e.add("danger",b+" : "+a):e.add("danger",a.message)}):401===a.status?f.path("/login"):500===a.status?e.add("danger","Internal server error!"):e.add("danger",a.date)})},a.deleteArticle=function(b){g.deleteArticle({id:b},function(b){e.add("success",b.data.success.message),a.getArticles()},function(a){e.add("success",a.data.error.message)})},a.pushArticle=function(b){g.pushArticle({id:b},function(b){e.add("success",b.data.success.message),console.log("文章推送成功"),a.getArticles()},function(a){e.add("error",a.data.error.message)})},a.getCategories=function(b){h.getCategories({type:b,parentId:""},function(b){console.log(b.data),a.categories=b.data},function(a){console.log("文章分类获取失败")})},a.getCategories("ARTICLE"),$(".ui.dropdown").dropdown({onChange:function(b,c,d){console.log(b),$("#categoryId").attr("value",b),a.categoryId=b}}),a.addCategory=function(){h.addCategory({parentId:a.categoryId,name:a.name,sort:a.sort,image:a.imageData,type:"ARTICLE"},function(b){console.log(b.data.success.message),e.add("success",b.data.success.message),a.getCategories("ARTICLE")},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"name"===b||"image"===b?e.add("danger",b+" : "+a):e.add("danger",a.message)}):401===a.status?f.path("/login"):500===a.status?e.add("danger","Internal server error!"):e.add("danger",a.date)})},a.images=[],a.getUploadToken=function(){d({method:"GET",url:j+"/admin/uploadToken",headers:{"X-AUTH-TOKEN":k.get("authToken")}}).then(function(b){a.uploadToken=b.data.success.message,console.log(a.uploadToken),a.initUpload()},function(a){console.log("uploadToken获取失败")})},a.getUploadToken(),a.initUpload=function(){Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:a.uploadToken,get_new_uptoken:!1,unique_names:!0,save_key:!1,domain:i,container:"upload-container",max_file_size:"100mb",flash_swf_url:"path/of/plupload/Moxie.swf",max_retries:3,dragdrop:!0,drop_element:"container",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){plupload.each(b,function(a){})},BeforeUpload:function(a,b){console.log("每个文件上传前,处理相关的事情")},UploadProgress:function(a,b){console.log("上传中"+a)},FileUploaded:function(b,c,d){console.log(d);var e=b.getOption("domain"),f=JSON.parse(d),g=e+f.key;a.images.push(g),a.cateImage=g,a.imageData=f.key,console.log(a.images),a.$apply()},Error:function(a,b,c){console.log(c)},UploadComplete:function(){},Key:function(a,b){var c="";return c}}})}}]),angular.module("clientApp").service("categoryService",["$http","$cookies","$cookieStore","apiUrl",function(a,b,c,d){var e=this;return e.addCategory=function(b,e,f){a({method:"POST",url:d+"/category?categoryType="+b.type+"&parentId="+b.parentId,headers:{"X-AUTH-TOKEN":c.get("authToken")},data:{name:b.name,sort:b.sort,image:b.image}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},e.updateCategory=function(b,e,f){a({data:{name:b.name,sort:b.sort,image:b.image},method:"PUT",url:d+"/category/"+b.categoryId,headers:{"X-AUTH-TOKEN":c.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},e.getCategories=function(b,e,f){a({method:"GET",url:d+"/categories?categoryType="+b.type+"&parentId="+b.parentId,headers:{"X-AUTH-TOKEN":c.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},e.deleteCategory=function(b,e,f){a({method:"DELETE",url:d+"/category/"+b.id,headers:{"X-AUTH-TOKEN":c.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},e}]),angular.module("clientApp").controller("CategoryCtrl",["$scope","$http","alertService","$location","categoryService",function(a,b,c,d,e){a.selectType="",a.getCategories=function(b){e.getCategories({type:b,parentId:0},function(b){console.log(b.data),a.categories=b.data},function(a){console.log("分类获取失败")})},a.getCategories(""),a.addCategory=function(b){e.addCategory({parentId:a.categoryId,name:a.name,sort:a.sort,image:a.image,type:"ARTICLE"},function(a){console.log(a.data.success.message),c.add("success",a.data.success.message),d.path("/category/list")},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"name"===b||"image"===b?c.add("danger",b+" : "+a):c.add("danger",a.message)}):401===a.status?d.path("/login"):500===a.status?c.add("danger","Internal server error!"):c.add("danger",a.date)})},a.deleteCategory=function(b){e.deleteCategory({id:b},function(b){c.add("success",b.data.success.message),a.getCategories("")},function(a){c.add("success",a.data.error.message)})}}]),angular.module("clientApp").service("videoService",["$http","$cookies","apiUrl","$cookieStore","ToKenHeader",function(a,b,c,d,e){var f=this;return f.addVideo=function(b,e,f){a({method:"POST",url:c+"/video",headers:{"X-AUTH-TOKEN":d.get("authToken")},data:{name:b.name,description:b.description,path:b.path,categoryId:b.categoryId,thumbnail:b.thumbnail}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.updateVideo=function(b,e,f){a({method:"PUT",url:c+"/video/"+b.videoId,headers:{"X-AUTH-TOKEN":d.get("authToken")},data:{name:b.name,description:b.description,path:b.path,categoryId:b.categoryId,thumbnail:b.thumbnail}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.getVideo=function(b,e,f){a({method:"GET",url:c+"/video/"+b.videoId,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.getVideos=function(b,e,f){a({method:"GET",url:c+"/videos?pageSize=10&page="+b.curPage,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.deleteVideo=function(b,e,f){a({method:"DELETE",url:c+"/video/"+b.videoId,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f}]),angular.module("clientApp").controller("VideoCtrl",["$scope","$routeParams","$rootScope","$http","alertService","$location","videoService","categoryService","cloudUrl","apiUrl","$cookieStore",function(a,b,c,d,e,f,g,h,i,j,k){a.curPage=f.search().currentPage?f.search().currentPage:1,a.getVideos=function(){g.getVideos({curPage:a.curPage},function(b){console.log(b.data),a.videos=b.data},function(a){console.log("视频获取失败")})},a.getVideos(),a.getVideoInfo=function(){g.getVideo({videoId:b.id},function(b){console.log(b.data);var c=b.data;a.name=c.name,a.description=c.description,editor.setValue(c.description),a.path=c.path,a.categoryId=c.category.id},function(a){e.add("error",a.data.success.message)})},null!=b.id&&a.getVideoInfo(),a.addVideo=function(){g.addVideo({name:a.name,description:editor.getValue(),path:a.path,categoryId:a.categoryId,thumbnail:a.imageData},function(b){a.subject="",a.description="",e.add("success",b.data.success.message),f.path("/video/list")},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"name"===b||"description"===b||"categoryId"==b?e.add("danger",b+" : "+a):e.add("danger",a.message)}):401===a.status?f.path("/login"):500===a.status?e.add("danger","Internal server error!"):e.add("danger",a.date)})},a.updateVideo=function(){g.updateVideo({videoId:b.id,name:a.name,description:editor.getValue(),path:a.path,categoryId:a.categoryId,thumbnail:a.imageData},function(b){a.subject="",a.description="",e.add("success",b.data.success.message),f.path("/video/list")},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"name"===b||"description"===b||"categoryId"==b?e.add("danger",b+" : "+a):e.add("danger",a.message)}):401===a.status?f.path("/login"):500===a.status?e.add("danger","Internal server error!"):e.add("danger",a.date)})},a.deleteVideo=function(b){g.deleteVideo({videoId:b},function(b){e.add("success",b.data.success.message),a.getVideos()},function(a){e.add("success",a.data.error.message)})},a.getCategories=function(b){h.getCategories({type:b,parentId:""},function(b){console.log(b.data),a.categories=b.data},function(a){console.log("视频分类获取失败")})},$(".ui.dropdown").dropdown({onChange:function(b,c,d){console.log(b),$("#categoryId").attr("value",b),a.categoryId=b}}),a.getCategories("VIDEO"),a.addCategory=function(){h.addCategory({parentId:a.categoryId,name:a.name,sort:a.sort,image:a.imageData,type:"VIDEO"},function(b){console.log(b.data.success.message),e.add("success",b.data.success.message),a.getCategories("VIDEO")},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"name"===b||"image"===b?e.add("danger",b+" : "+a):e.add("danger",a.message)}):401===a.status?f.path("/login"):500===a.status?e.add("danger","Internal server error!"):e.add("danger",a.date)})},a.images=[],a.getUploadToken=function(){d({method:"GET",url:j+"/admin/uploadToken",headers:{"X-AUTH-TOKEN":k.get("authToken")}}).then(function(b){a.uploadToken=b.data.success.message,console.log(a.uploadToken),a.initUpload(),a.initUploadImage()},function(a){console.log("uploadToken获取失败")})},a.getUploadToken(),a.uploadStatus="等待选择文件",a.initUpload=function(){Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:a.uploadToken,get_new_uptoken:!1,unique_names:!0,save_key:!1,domain:i,container:"upload-container",max_file_size:"4096mb",flash_swf_url:"path/of/plupload/Moxie.swf",max_retries:3,dragdrop:!0,drop_element:"container",chunk_size:"5mb",auto_start:!0,init:{FilesAdded:function(b,c){console.log("文件添加"),a.uploadStatus="文件添加"},BeforeUpload:function(b,c){console.log("准备上传"),a.uploadStatus="准备上传"},UploadProgress:function(b,c){console.log(c.percent+"%"),console.log(c.speed);var d=c.percent+"%";a.uploadStatus="上传进度:"+d+" 速度:"+plupload.formatSize(c.speed).toUpperCase()+"/s",a.$apply(),$("#example2").progress({percent:c.percent})},UploadComplete:function(){console.log("上传成功"),a.uploadStatus="上传成功"},FileUploaded:function(b,c,d){a.uploadStatus="上传完毕",console.log("上传完毕");var e=b.getOption("domain"),f=JSON.parse(d),g=e+f.key;a.sourceLink=g,a.path=f.key},Error:function(b,c,d){console.log("上传出错"),a.uploadStatus="上传出错"}}})},a.initUploadImage=function(){Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickImages",uptoken:a.uploadToken,get_new_uptoken:!1,unique_names:!0,save_key:!1,domain:"http://storage.workerhub.cn/",container:"upload-image-container",max_file_size:"3mb",flash_swf_url:"path/of/plupload/Moxie.swf",max_retries:3,dragdrop:!0,drop_element:"container",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){plupload.each(b,function(a){})},BeforeUpload:function(a,b){console.log("每个文件上传前,处理相关的事情")},UploadProgress:function(a,b){console.log(a)},FileUploaded:function(b,c,d){console.log(d);var e=b.getOption("domain"),f=JSON.parse(d),g=e+f.key;a.images.push(g),a.cateImage=g,a.imageData=f.key,console.log(a.images),a.$apply()},Error:function(a,b,c){console.log(c)},UploadComplete:function(){},Key:function(a,b){var c="";return c}}})}}]),angular.module("clientApp").service("signupService",["$http","$cookies","$cookieStore","apiUrl","ToKenHeader",function(a,b,c,d,e){var f=this;return f.signup=function(b,e,f){a({method:"POST",url:d+"/admin/signup",headers:{"X-AUTH-TOKEN":c.get("authToken")},data:b}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.login=function(b,c,e){a({method:"POST",url:d+"/admin/login",data:b}).then(function(a){"function"==typeof c&&c(a)},function(a){"function"==typeof e&&e(a)})},f.isAuthenticated=function(b,e,f){a({method:"GET",url:d+"/admin/isauthenticated",headers:{"X-AUTH-TOKEN":c.get("authToken")},data:b}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f}]),angular.module("clientApp").controller("QuestionCtrl",["$scope","$routeParams","$rootScope","$http","alertService","$location","questionService","apiUrl","$cookieStore","categoryService",function(a,b,c,d,e,f,g,h,i,j){a.status=f.search().status?f.search().status:"",a.getCategories=function(b){j.getCategories({type:b,parentId:""},function(b){console.log(b.data),a.categories=b.data},function(a){console.log("问题分类获取失败")})},a.getCategories("QUESTION"),$(".ui.dropdown").dropdown({onChange:function(b,c,d){console.log(b),$("#categoryId").attr("value",b),a.categoryId=b}}),$(".ui.assignExpertId").dropdown({onChange:function(b,c,d){$("#assignExpertId").attr("value",b),console.log("选择专家:"),console.log(b),a.assignExpertId=b}}),a.addCategory=function(){j.addCategory({parentId:a.categoryId,name:a.name,sort:a.sort,image:a.imageData,type:"QUESTION"},function(b){console.log(b.data.success.message),e.add("success",b.data.success.message),a.getCategories("QUESTION")},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"name"===b||"image"===b?e.add("danger",b+" : "+a):e.add("danger",a.message)}):401===a.status?f.path("/login"):500===a.status?e.add("danger","Internal server error!"):e.add("danger",a.date)})},a.curPage=f.search().currentPage?f.search().currentPage:1,a.getQuestions=function(){g.getQuestions({curPage:a.curPage,status:a.status},function(b){console.log(b.data),a.questions=b.data},function(a){console.log("问题获取失败")})},a.getQuestions(),a.getQuestionInfo=function(){g.getQuestion({questionId:b.id},function(b){console.log(b.data);var c=b.data;a.title=c.title,a.content=c.content,a.tag=c.tag,a.sort=c.sort,a.image=c.image,a.images=c.image.split(","),a.categoryId=c.category.id},function(a){e.add("error",a.data.success.message)})},null!=b.id&&a.getQuestionInfo(),a.deleteQuestion=function(b){g.deleteQuestion({id:b},function(b){e.add("success",b.data.success.message),a.getQuestions()},function(a){e.add("success",a.data.error.message)})},a.auditQuestion=function(b){a.curQuestion=b,console.log("审核问题")},a.auditWithRefuse=function(b){console.log("拒绝审核"),d({method:"PUT",url:h+"/question/"+b.id+"/auditfail",headers:{"X-AUTH-TOKEN":i.get("authToken")}}).then(function(b){e.add("success",b.data.success.message),a.getQuestions()},function(a){e.add("error",a.data.success.message)})},a.auditWithPass=function(b){console.log("通过审核"),d({method:"PUT",url:h+"/question/"+b.id+"/auditpass",headers:{"X-AUTH-TOKEN":i.get("authToken")}}).then(function(b){e.add("success",b.data.success.message),a.getQuestions()},function(a){e.add("error",a.data.success.message)})},a.assignToexpert=function(b){console.log("指派给问题"),d({method:"PUT",url:h+"/question/"+b.id+"/assign/"+a.assignExpertId,headers:{"X-AUTH-TOKEN":i.get("authToken")}}).then(function(b){e.add("success",b.data.success.message),a.getQuestions()},function(a){e.add("error",a.data.success.message)})},a.loadExperts=function(){d({method:"GET",url:h+"/foradmin/experts",headers:{"X-AUTH-TOKEN":i.get("authToken")}}).then(function(b){a.experts=b.data},function(a){})},a.loadExperts()}]),angular.module("clientApp").service("questionService",["$http","$cookies","apiUrl","$cookieStore","ToKenHeader",function(a,b,c,d,e){var f=this;return f.updateQuestion=function(b,e,f){a({method:"PUT",url:c+"/question/"+b.questionId,headers:{"X-AUTH-TOKEN":d.get("authToken")},data:{title:b.title,content:b.content,tag:b.tag,sort:b.sort,image:b.image,categoryId:b.categoryId}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.getQuestion=function(b,e,f){a({method:"GET",url:c+"/question/"+b.questionId,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.getQuestions=function(b,e,f){a({method:"GET",url:c+"/foradmin/questions?pageSize=20&page="+b.curPage+"&status="+b.status,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.deleteQuestion=function(b,e,f){a({method:"DELETE",url:c+"/question/"+b.id,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f}]),angular.module("clientApp").controller("UserCtrl",["$scope","$http","alertService","$location","categoryService","apiUrl","$cookieStore","expertService",function(a,b,c,d,e,f,g,h){a.selectType="",a.curPage=d.search().currentPage?d.search().currentPage:1,a.searchType="phone",a.searchPhone="",a.searchUserName="",a.searchRealName="",a.searchValue="",$(".ui.selection.dropdown").dropdown({
onChange:function(b,c,d){console.log(b),a.searchType=b}}),a.getUsers=function(c){console.log(a.searchType),"phone"==a.searchType?a.searchPhone=a.searchValue:"userName"==a.searchType?a.searchUserName=a.searchValue:"realName"==a.searchType&&(a.searchRealName=a.searchValue),b({method:"GET",url:f+"/users?pageSize=20&page="+a.curPage+"&phone="+a.searchPhone+"&userName="+a.searchUserName+"&realName="+a.searchRealName,headers:{"X-AUTH-TOKEN":g.get("authToken")}}).then(function(b){console.log(b.data),a.users=b.data},function(a){console.log("用户数据获取失败")})},a.getUsers(""),a.deleteUser=function(d){b({method:"DELETE",url:f+"/user/"+d,headers:{"X-AUTH-TOKEN":g.get("authToken")}}).then(function(b){c.add("success",b.data.success.message),a.getUsers("")},function(a){c.add("success",a.data.error.message)})},a.getCategories=function(b){e.getCategories({type:b,parentId:""},function(b){console.log(b.data),a.categories=b.data},function(a){console.log("专家分类获取失败")})},a.getCategories("EXPERT"),$(".ui.dropdown").dropdown({onChange:function(b,c,d){console.log(b),$("#categoryId").attr("value",b),a.categoryId=b,a.searchType=b}}),a.getUploadToken=function(){b({method:"GET",url:f+"/admin/uploadToken",headers:{"X-AUTH-TOKEN":g.get("authToken")}}).then(function(b){a.uploadToken=b.data.success.message,console.log(a.uploadToken),a.initUpload()},function(a){console.log("uploadToken获取失败")})},a.getUploadToken(),a.initUpload=function(){Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:a.uploadToken,get_new_uptoken:!1,unique_names:!0,save_key:!1,domain:"http://storage.workerhub.cn/",container:"upload-container",max_file_size:"100mb",flash_swf_url:"path/of/plupload/Moxie.swf",max_retries:3,dragdrop:!0,drop_element:"container",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){plupload.each(b,function(a){})},BeforeUpload:function(a,b){console.log("每个文件上传前,处理相关的事情")},UploadProgress:function(a,b){console.log(a)},FileUploaded:function(b,c,d){console.log(d);var e=b.getOption("domain"),f=JSON.parse(d),g=e+f.key;a.cateImage=g,a.avatar=f.key,console.log(a.cateImage),a.$apply()},Error:function(a,b,c){console.log(c)},UploadComplete:function(){},Key:function(a,b){var c="";return c}}})},a.toAddExpert=function(b){a.curUserid=b.id},a.toChangePass=function(b){a.curUserid=b.id},a.changePass=function(){a.changePass=function(d){b({method:"PUT",url:f+"/foradmin/user/password",headers:{"X-AUTH-TOKEN":g.get("authToken")},data:{userId:a.curUserid,newPassword:a.password}}).then(function(a){c.add("success",a.data.success.message)},function(a){c.add("error",a.data.error.message)})}},a.addExpert=function(){h.addExpert({userId:a.curUserid,name:a.name,categoryId:a.categoryId,professional:a.professional,duty:a.duty,introduction:a.introduction,service:a.service,company:a.company,avatar:a.avatar},function(b){a.subject="",a.content="",c.add("success",b.data.success.message),d.path("/expert/list")},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"name"===b||"content"===b||"categoryId"==b?c.add("danger",b+" : "+a):c.add("danger",a.message)}):401===a.status?d.path("/login"):500===a.status?c.add("danger","Internal server error!"):c.add("danger",a.date)})}}]),angular.module("clientApp").controller("TradeCtrl",["$scope","$routeParams","$rootScope","$http","alertService","$location","questionService","$cookieStore","apiUrl","categoryService",function(a,b,c,d,e,f,g,h,i,j){a.curPage=f.search().currentPage?f.search().currentPage:1,a.tradeType=f.search().tradeType?f.search().tradeType:"",a.status=f.search().status?f.search().status:"",a.getTrades=function(){d({method:"GET",url:i+"/foradmin/trades?pageSize=20&page="+a.curPage+"&tradeType="+a.tradeType+"&status="+a.status,data:{},headers:{"X-AUTH-TOKEN":h.get("authToken")}}).then(function(b){console.log(b.data),a.trades=b.data},function(a){console.log("交易数据获取失败")})},a.getTrades(),a.getTradeInfo=function(){g.getTrade({questionId:b.id},function(b){console.log(b.data);var c=b.data;a.title=c.title,a.content=c.content,a.tag=c.tag,a.sort=c.sort,a.image=c.image,a.categoryId=c.category.id},function(a){e.add("error",a.data.success.message)})},null!=b.id&&a.getTradeInfo(),a.deleteTrade=function(b){d({method:"DELETE",url:i+"/trade/"+b.id,headers:{"X-AUTH-TOKEN":h.get("authToken")}}).then(function(b){e.add("success",b.data.success.message),a.getTrades()},function(a){e.add("success",a.data.error.message)})},a.auditTrade=function(b){a.curTrade=b,console.log("审核交易")},a.auditWithRefuse=function(b){console.log("拒绝审核"),d({method:"PUT",url:i+"/trade/"+b.id+"/auditfail",headers:{"X-AUTH-TOKEN":h.get("authToken")}}).then(function(b){console.log(b.data),e.add("success",b.data.success.message),a.getTrades(),$(".at-audit-trade").modal("hide"),$(".modal-backdrop").hide()},function(a){console.log(a.data),e.add("error",a.data.success.message)})},a.auditWithPass=function(b){console.log("通过审核"),d({method:"PUT",url:i+"/trade/"+b.id+"/auditpass",headers:{"X-AUTH-TOKEN":h.get("authToken")}}).then(function(b){console.log(b.data),e.add("success",b.data.success.message),a.getTrades(),$(".at-audit-trade").modal("hide"),$(".modal-backdrop").hide()},function(a){console.log(a.data),e.add("error",a.data.success.message)})},a.getUploadToken=function(){d({method:"GET",url:i+"/admin/uploadToken",headers:{"X-AUTH-TOKEN":h.get("authToken")}}).then(function(b){a.uploadToken=b.data.success.message,console.log(a.uploadToken),a.initUploadImage()},function(a){console.log("uploadToken获取失败")})},a.getUploadToken(),a.initUploadImage=function(){Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickImages",uptoken:a.uploadToken,get_new_uptoken:!1,unique_names:!0,save_key:!1,domain:"http://storage.workerhub.cn/",container:"upload-image-container",max_file_size:"3mb",flash_swf_url:"path/of/plupload/Moxie.swf",max_retries:3,dragdrop:!0,drop_element:"container",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){plupload.each(b,function(a){})},BeforeUpload:function(a,b){console.log("每个文件上传前,处理相关的事情")},UploadProgress:function(a,b){console.log(a)},FileUploaded:function(b,c,d){console.log(d);var e=b.getOption("domain"),f=JSON.parse(d),g=e+f.key;a.cateImage=g,a.imageData=f.key,console.log(a.images),a.$apply()},Error:function(a,b,c){console.log(c)},UploadComplete:function(){},Key:function(a,b){var c="";return c}}})},a.getCategories=function(b){j.getCategories({type:b,parentId:""},function(b){console.log(b.data),a.categories=b.data},function(a){console.log("视频分类获取失败")})},a.getCategories("TRADE"),a.addCategory=function(){j.addCategory({parentId:0,name:a.name,sort:a.sort,type:"TRADE"},function(b){console.log(b.data.success.message),e.add("success",b.data.success.message),a.getCategories("TRADE")},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"name"===b||"image"===b?e.add("danger",b+" : "+a):e.add("danger",a.message)}):401===a.status?f.path("/login"):500===a.status?e.add("danger","Internal server error!"):e.add("danger",a.date)})}}]),angular.module("clientApp").controller("LinkCtrl",["$scope","$rootScope","$http","alertService","$location","linkService",function(a,b,c,d,e,f){a.curPage=e.search().currentPage?e.search().currentPage:1,a.getLinks=function(){f.getLinks({curPage:a.curPage},function(b){console.log(b.data),a.links=b.data},function(a){console.log("链接获取失败")})},a.getLinks(),a.deleteLink=function(b){f.deleteLink({linkId:b},function(b){d.add("success",b.data.success.message),a.getLinks()},function(a){d.add("success",a.data.error.message)})},a.addLink=function(){f.addLink({name:a.name,url:a.url,image:a.image},function(b){a.name="",a.url="",a.image="",d.add("success",b.data.success.message),a.getLinks()},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"name"===b||"url"===b||"image"==b?d.add("danger",b+" : "+a):d.add("danger",a.message)}):401===a.status?e.path("/login"):500===a.status?d.add("danger","Internal server error!"):d.add("danger",a.date)})}}]),angular.module("clientApp").service("linkService",["$http","$cookies","$cookieStore","apiUrl",function(a,b,c,d){var e=this;return e.addLink=function(b,e,f){a({method:"POST",url:d+"/link",headers:{"X-AUTH-TOKEN":c.get("authToken")},data:{name:b.name,url:b.url,image:b.image}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},e.deleteLink=function(b,e,f){a({method:"DELETE",url:d+"/link/"+b.linkId,headers:{"X-AUTH-TOKEN":c.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},e.updateLink=function(b,e,f){a({method:"PUT",url:d+"/link/"+b.linkId,headers:{"X-AUTH-TOKEN":c.get("authToken")},data:{name:b.name,url:b.url,image:b.image}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},e.getLinks=function(b,e,f){a({method:"GET",url:d+"/links?pageSize=20&page="+b.curPage,headers:{"X-AUTH-TOKEN":c.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},e}]),angular.module("clientApp").controller("AdvCtrl",["$scope","$routeParams","$cookieStore","$rootScope","$http","alertService","$location","advService","categoryService","cloudUrl","apiUrl",function(a,b,c,d,e,f,g,h,i,j,k){a.curPage=g.search().currentPage?g.search().currentPage:1,$(".ui.dropdown").dropdown({onChange:function(b,c,d){console.log(b),$("#position").attr("value",b),a.position=b}}),a.getAdvs=function(){h.getAdvs({curPage:a.curPage},function(b){console.log(b.data),a.advs=b.data},function(a){console.log("广告获取失败")})},a.getAdvs(),a.getAdvInfo=function(){h.getAdv({advId:b.id},function(b){console.log(b.data);var c=b.data;a.name=c.name,a.description=c.description,editor.setValue(c.description),a.url=c.url,a.image=c.image,a.position=c.position},function(a){f.add("error",a.data.success.message)})},null!=b.id&&a.getAdvInfo(),a.addAdv=function(){h.addAdv({name:a.name,description:a.description,url:a.url,sort:a.sort,image:a.imageData,position:a.position},function(b){a.subject="",a.content="",f.add("success",b.data.success.message),g.path("/adv/list")},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"title"===b||"content"===b||"categoryId"==b?f.add("danger",b+" : "+a):f.add("danger",a.message)}):401===a.status?g.path("/login"):500===a.status?f.add("danger","Internal server error!"):f.add("danger",a.date)})},a.updateAdv=function(){h.updateAdv({advId:b.id,name:a.name,description:a.description,url:a.url,sort:a.sort,image:a.imageData,position:a.position},function(b){a.subject="",a.content="",f.add("success",b.data.success.message),g.path("/adv/list")},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"title"===b||"content"===b||"categoryId"==b?f.add("danger",b+" : "+a):f.add("danger",a.message)}):401===a.status?g.path("/login"):500===a.status?f.add("danger","Internal server error!"):f.add("danger",a.date)})},a.deleteAdv=function(b){h.deleteAdv({id:b},function(b){f.add("success",b.data.success.message),a.getAdvs()},function(a){f.add("success",a.data.error.message)})},a.images=[],a.getUploadToken=function(){e({method:"GET",url:k+"/admin/uploadToken",headers:{"X-AUTH-TOKEN":c.get("authToken")}}).then(function(b){a.uploadToken=b.data.success.message,console.log(a.uploadToken),a.initUpload()},function(a){console.log("uploadToken获取失败")})},a.getUploadToken(),a.initUpload=function(){Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:a.uploadToken,get_new_uptoken:!1,unique_names:!0,save_key:!1,domain:"http://storage.workerhub.cn/",container:"upload-container",max_file_size:"100mb",flash_swf_url:"path/of/plupload/Moxie.swf",max_retries:3,dragdrop:!0,drop_element:"container",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){plupload.each(b,function(a){})},BeforeUpload:function(a,b){console.log("每个文件上传前,处理相关的事情")},UploadProgress:function(a,b){console.log(a)},FileUploaded:function(b,c,d){console.log(d);var e=b.getOption("domain"),f=JSON.parse(d),g=e+f.key;a.images.push(g),a.cateImage=g,a.imageData=f.key,console.log(a.images),a.$apply()},Error:function(a,b,c){console.log(c)},UploadComplete:function(){},Key:function(a,b){var c="";return c}}})}}]),angular.module("clientApp").service("advService",["$http","$cookies","apiUrl","$cookieStore","ToKenHeader",function(a,b,c,d,e){var f=this;return f.addAdv=function(b,e,f){a({method:"POST",url:c+"/advertisement",headers:{"X-AUTH-TOKEN":d.get("authToken")},data:{name:b.name,description:b.description,url:b.url,image:b.image,position:b.position}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.updateAdv=function(b,e,f){a({method:"PUT",url:c+"/advertisement/"+b.advId,headers:{"X-AUTH-TOKEN":d.get("authToken")},data:{name:b.name,description:b.description,url:b.url,image:b.image,position:b.position}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.getAdv=function(b,e,f){a({method:"GET",url:c+"/advertisement/"+b.advId,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.getAdvs=function(b,e,f){a({method:"GET",url:c+"/advertisements?pageSize=10&page="+b.curPage,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.deleteAdv=function(b,e,f){a({method:"DELETE",url:c+"/advertisement/"+b.id,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f}]),angular.module("clientApp").controller("ExpertCtrl",["$scope","$http","alertService","$location","categoryService","apiUrl","$cookieStore","expertService",function(a,b,c,d,e,f,g,h){a.curPage=d.search().currentPage?d.search().currentPage:1,a.getCategories=function(b){e.getCategories({type:b,parentId:""},function(b){console.log(b.data),a.categories=b.data},function(a){console.log("专家分类获取失败")})},a.getCategories("EXPERT"),$(".ui.dropdown").dropdown({onChange:function(b,c,d){console.log(b),$("#categoryId").attr("value",b),a.categoryId=b}}),a.addCategory=function(){e.addCategory({parentId:a.categoryId,name:a.name,sort:a.sort,image:a.imageData,type:"EXPERT"},function(b){console.log(b.data.success.message),c.add("success",b.data.success.message),a.getCategories("EXPERT")},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"name"===b||"image"===b?c.add("danger",b+" : "+a):c.add("danger",a.message)}):401===a.status?d.path("/login"):500===a.status?c.add("danger","Internal server error!"):c.add("danger",a.date)})},a.getExperts=function(){b({method:"GET",url:f+"/experts?categoryId=&pageSize=20&page="+a.curPage,headers:{"X-AUTH-TOKEN":g.get("authToken")}}).then(function(b){console.log(b.data),a.experts=b.data},function(a){console.log("专家数据获取失败")})},a.getExperts(""),a.addExpert=function(){h.addExpert({userId:a.userId,name:a.name,category:a.category,professional:a.professional,duty:a.duty,introduction:a.introduction,service:a.service,company:a.company},function(b){a.subject="",a.content="",c.add("success",b.data.success.message),d.path("/expert/list")},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"name"===b||"content"===b||"categoryId"==b?c.add("danger",b+" : "+a):c.add("danger",a.message)}):401===a.status?d.path("/login"):500===a.status?c.add("danger","Internal server error!"):c.add("danger",a.date)})},a.getUploadToken=function(){b({method:"GET",url:f+"/admin/uploadToken",headers:{"X-AUTH-TOKEN":g.get("authToken")}}).then(function(b){a.uploadToken=b.data.success.message,console.log(a.uploadToken),a.initUpload()},function(a){console.log("uploadToken获取失败")})},a.getUploadToken(),a.initUpload=function(){Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:a.uploadToken,get_new_uptoken:!1,unique_names:!0,save_key:!1,domain:"http://storage.workerhub.cn/",container:"upload-container",max_file_size:"100mb",flash_swf_url:"path/of/plupload/Moxie.swf",max_retries:3,dragdrop:!0,drop_element:"container",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(a,b){plupload.each(b,function(a){})},BeforeUpload:function(a,b){console.log("每个文件上传前,处理相关的事情")},UploadProgress:function(a,b){console.log(a)},FileUploaded:function(b,c,d){console.log(d);var e=b.getOption("domain"),f=JSON.parse(d),g=e+f.key;a.cateImage=g,a.avatar=f.key,console.log(a.cateImage),a.$apply()},Error:function(a,b,c){console.log(c)},UploadComplete:function(){},Key:function(a,b){var c="";return c}}})},a.toUpdateExpert=function(b){a.curUserid=b.id,a.name=b.user.realName,a.categoryId=b.category.id,a.professional=b.professional,a.duty=b.duty,a.introduction=b.introduction,a.remark=b.remark,a.service=b.service,a.company=b.company,a.avatar=b.user.avatar,a.cateImage="http://storage.workerhub.cn/"+b.user.avatar},a.updateExpert=function(){h.updateExpert({userId:a.curUserid,name:a.name,categoryId:a.categoryId,professional:a.professional,duty:a.duty,introduction:a.introduction,service:a.service,company:a.company,avatar:a.avatar,remark:a.remark},function(b){a.subject="",a.content="",c.add("success",b.data.success.message),a.getExperts("")},function(a){console.log(a),400===a.status?angular.forEach(a.data,function(a,b){"name"===b||"content"===b||"categoryId"==b?c.add("danger",b+" : "+a):c.add("danger",a.message)}):401===a.status?d.path("/login"):500===a.status?c.add("danger","Internal server error!"):c.add("danger",a.date)})}}]),angular.module("clientApp").service("expertService",["$http","$cookies","apiUrl","$cookieStore","ToKenHeader",function(a,b,c,d,e){var f=this;return f.getExperts=function(b,e,f){a({method:"GET",url:c+"/experts?pageSize=10&page="+b.curPage,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.addExpert=function(b,e,f){a({method:"POST",url:c+"/user/"+b.userId+"/experts",headers:{"X-AUTH-TOKEN":d.get("authToken")},data:{name:b.name,categoryId:b.categoryId,professional:b.professional,duty:b.duty,introduction:b.introduction,service:b.service,company:b.company,avatar:b.avatar}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.updateExpert=function(b,e,f){a({method:"PUT",url:c+"/foradmin/expert/"+b.userId,headers:{"X-AUTH-TOKEN":d.get("authToken")},data:{name:b.name,categoryId:b.categoryId,professional:b.professional,duty:b.duty,introduction:b.introduction,service:b.service,company:b.company,avatar:b.avatar,remark:b.remark}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f}]),angular.module("clientApp").controller("CommentCtrl",["$scope","$http","alertService","$location","commentService","apiUrl","$cookieStore",function(a,b,c,d,e,f,g){a.selectType="",a.curPage=d.search().currentPage?d.search().currentPage:1,a.status=d.search().status?d.search().status:"",a.getComments=function(){e.getComments({curPage:a.curPage,status:a.status},function(b){console.log(b.data),a.comments=b.data},function(a){console.log("评论获取失败")})},a.getComments(""),a.deleteComment=function(b){e.deleteComment({id:b},function(b){c.add("success",b.data.success.message),a.getComments("")},function(a){c.add("success",a.data.error.message)})},a.$watch(a.selectType,a.getComments(a.selectType)),a.auditComment=function(b){a.curComment=b,console.log("审核评论")},a.auditWithRefuse=function(d){console.log("拒绝审核"),b({method:"PUT",url:f+"/comment/"+d.id+"/auditfail",headers:{"X-AUTH-TOKEN":g.get("authToken")}}).then(function(b){console.log(b.data),c.add("success",b.data.success.message),a.getComments()},function(a){console.log(a.data),c.add("error",a.data.success.message)})},a.auditWithPass=function(d){console.log("通过审核"),b({method:"PUT",url:f+"/comment/"+d.id+"/auditpass",headers:{"X-AUTH-TOKEN":g.get("authToken")}}).then(function(b){console.log(b.data),c.add("success",b.data.success.message),a.getComments()},function(a){console.log(a.data),c.add("error",a.data.success.message)})}}]),angular.module("clientApp").service("commentService",["$http","$cookies","$cookieStore","apiUrl",function(a,b,c,d){var e=this;return e.getComments=function(b,e,f){a({method:"GET",url:d+"/comments?pageSize=20&page="+b.curPage+"&status="+b.status,headers:{"X-AUTH-TOKEN":c.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},e.deleteComment=function(b,e,f){a({method:"DELETE",url:d+"/comment/"+b.id,headers:{"X-AUTH-TOKEN":c.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},e}]),angular.module("clientApp").controller("ExpertInfoCtrl",["$scope","$routeParams","$rootScope","$http","alertService","$location","expertInfoService","categoryService","cloudUrl","apiUrl","$cookieStore",function(a,b,c,d,e,f,g,h,i,j,k){a.curPage=f.search().currentPage?f.search().currentPage:1,a.imageData="null",a.getArticlesByExpert=function(){g.getArticlesByExpert({curPage:a.curPage},function(b){console.log(b.data),a.articles=b.data},function(a){console.log("文章获取失败")})},a.getArticlesByExpert(),a.getAlbumsByExpert=function(){g.getAlbumsByExpert({curPage:a.curPage},function(b){console.log(b.data),a.albums=b.data},function(a){console.log("相册获取失败")})},a.getAlbumsByExpert(),$(".ui.dropdown").dropdown({onChange:function(b,c,d){console.log(b),$("#categoryId").attr("value",b),a.categoryId=b}})}]),angular.module("clientApp").service("expertInfoService",["$http","$cookies","apiUrl","$cookieStore","ToKenHeader",function(a,b,c,d,e){var f=this;return f.getArticlesByExpert=function(b,e,f){a({method:"GET",url:c+"/articles?pageSize=10&page="+b.curPage,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f.getAlbumsByExpert=function(b,e,f){a({method:"GET",url:c+"/albums?pageSize=10&page="+b.curPage,headers:{"X-AUTH-TOKEN":d.get("authToken")}}).then(function(a){"function"==typeof e&&e(a)},function(a){"function"==typeof f&&f(a)})},f}]),angular.module("clientApp").controller("AdminCtrl",["$scope","$http","alertService","$location","categoryService","apiUrl","$cookieStore","expertService","signupService",function(a,b,c,d,e,f,g,h,i){a.selectType="",a.curPage=d.search().currentPage?d.search().currentPage:1,a.getAdmins=function(c){b({method:"GET",url:f+"/admins?pageSize=20&page="+a.curPage,headers:{"X-AUTH-TOKEN":g.get("authToken")}}).then(function(b){console.log(b.data),a.users=b.data},function(a){console.log("管理员数据获取失败")})},a.getAdmins(""),a.deleteAdmin=function(d){b({method:"DELETE",url:f+"/admin/"+d,headers:{"X-AUTH-TOKEN":g.get("authToken")}}).then(function(b){c.add("success",b.data.success.message),a.getAdmins("")},function(a){c.add("success",a.data.error.message)})},a.signup=function(){var b={email:a.email,password:a.password,phone:a.phone,name:a.name};i.signup(b,function(b){c.add("success","管理员添加成功"),a.getAdmins("")},function(a){400===a.status&&angular.forEach(a.data,function(a,b){"email"===b||"password"===b?c.add("danger",b+" : "+a):c.add("danger",a.message)}),500===status&&c.add("danger","Internal server error!")})}}]),angular.module("clientApp").controller("MessageCtrl",["$scope","$http","alertService","$location","apiUrl","$cookieStore",function(a,b,c,d,e,f){a.selectType="",a.curPage=d.search().currentPage?d.search().currentPage:1,a.getMessages=function(c){b({method:"GET",url:e+"/foradmin/messages?pageSize=20&page="+a.curPage,headers:{"X-AUTH-TOKEN":f.get("authToken")}}).then(function(b){a.messages=b.data},function(a){console.log("消息获取失败")})},a.getMessages("")}]),angular.module("clientApp").controller("AppCtrl",["$scope","$http","alertService","$location","categoryService","apiUrl","$cookieStore","cloudUrl",function(a,b,c,d,e,f,g,h){a.selectType="",a.curPage=d.search().currentPage?d.search().currentPage:1,a.getAppUpdateLogs=function(c){b({method:"GET",url:f+"/app/logs?pageSize=20&page="+a.curPage,headers:{"X-AUTH-TOKEN":g.get("authToken")}}).then(function(b){console.log(b.data),a.logs=b.data},function(a){console.log("管理员数据获取失败")})},a.getAppUpdateLogs(""),a.addAppUpdateLog=function(){b({method:"POST",url:f+"/app/logs",headers:{"X-AUTH-TOKEN":g.get("authToken")},data:{desc:a.desc,remark:a.remark,apkVersionName:a.apkVersionName,apkVersion:a.apkVersion,isPublic:1,isPush:1,apkPath:a.apkPath}}).then(function(b){c.add("success",b.data.success.message),a.getAppUpdateLogs("")},function(a){c.add("success",a.data.error.message)})},a.getUploadToken=function(){b({method:"GET",url:f+"/admin/uploadToken",headers:{"X-AUTH-TOKEN":g.get("authToken")}}).then(function(b){a.uploadToken=b.data.success.message,console.log(a.uploadToken),a.initUpload()},function(a){console.log("uploadToken获取失败")})},a.getUploadToken(),a.uploadStatus="等待选择文件",a.initUpload=function(){Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken:a.uploadToken,get_new_uptoken:!1,unique_names:!0,save_key:!1,domain:h,container:"upload-container",max_file_size:"100mb",flash_swf_url:"path/of/plupload/Moxie.swf",max_retries:3,dragdrop:!0,drop_element:"container",chunk_size:"5mb",auto_start:!0,init:{FilesAdded:function(b,c){console.log("文件添加"),a.uploadStatus="文件添加"},BeforeUpload:function(b,c){console.log("准备上传"),a.uploadStatus="准备上传"},UploadProgress:function(b,c){console.log(c.percent+"%"),console.log(c.speed);var d=c.percent+"%";a.uploadStatus="上传进度:"+d+" 速度:"+plupload.formatSize(c.speed).toUpperCase()+"/s",a.$apply(),$("#example2").progress({percent:c.percent})},UploadComplete:function(){console.log("上传成功"),a.uploadStatus="上传成功"},FileUploaded:function(b,c,d){a.uploadStatus="上传完毕",console.log("上传完毕");var e=b.getOption("domain"),f=JSON.parse(d),g=e+f.key;a.sourceLink=g,a.apkPath=f.key},Error:function(b,c,d){console.log("上传出错"),a.uploadStatus="上传出错"}}})}}]),angular.module("clientApp").service("deskNotice",["$location",function(a){function b(a){var b;b=a.target?Promise.resolve([a.target]):Notification.get({tag:a.tag}),b.then(function(a){for(var b=0;b<a.length;b++)a[b].close()})}function c(a){window.focus(),b(a)}var d=this;return d.showDeskNotice=function(a,b,d){function e(){var c=window.webkitNotifications.createNotification(a,b);c.display=function(){setTimeout(function(){this.close()},3e3)},c.onerror=function(){},c.onclose=function(){},c.onclick=function(){window.focus(),this.cancel()},c.replaceId="Meteoric",c.show()}if(window.webkitNotifications)0==window.webkitNotifications.checkPermission()?e():window.webkitNotifications.requestPermission(function(a){"permission"in Notification||(Notification.permission=a),"granted"===a&&e()});else if("Notification"in window){var f,b=b.trim();"granted"===Notification.permission?(f=new Notification(a,{body:b.trim(),tag:d}),f.onshow=function(){setTimeout(function(){f.close()},3e3)}):"denied"!==Notification.permission&&Notification.requestPermission(function(c){"permission"in Notification||(Notification.permission=c),"granted"===c&&(f=new Notification(a,{body:b.trim(),tag:d}),f.onshow=function(){setTimeout(function(){f.close()},3e3)})}),f.addEventListener("error",function(a){console.log("something went wrong"),console.log(a)}),f.addEventListener("click",c)}},d}]);